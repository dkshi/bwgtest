# BWGTest: Тестовое задание в Кадровое агентство BWG
---

<img src='https://i.pinimg.com/originals/dc/5c/15/dc5c1531665d0c2618623c563126c8a3.jpg' width='300' height='300'>

## Описание

REST API сервис для управления валютными котировками:
- Обновление котировки
- Получить котировку по идентификатору обновления
- Получить последнее значение котировки

## Замечания
- Использовал PostgreSQL
- Написал unit-тесты
- Добавил сваггер документацию (localhost:8080/swagger/index.html)
- Использовал [Frankfurter](https://www.frankfurter.app/docs/) для получение актуальных значений котировок.
- Котировка в БД имеет поле "success", оно сигнализирует прошло ли обновление успешно.
- Обновления происходят с помощью триггера и listener'a: триггер фиксирует каждый INSERT и выполняет функцию, которая отправляет новую запись в канал listener'a. Чтобы взаимодействие с внешнем API не происходило на слое репозитория, эта запись декодируется из JSON'a в структуру и отправляется по каналу связи в сервисный слой, где происходит обработка.
- Обработчик, возвращающий актуальную котировку, на самом деле возвращает самое последнее ВАЛИДНОЕ значение котировки. То есть, он игнорирует обновления не обработанные или обработанные с ошибкой (success=false).


## Компоненты
- Docker: [Installation Guide](https://docs.docker.com/get-docker/)
- Docker Compose: [Installation Guide](https://docs.docker.com/compose/install/)

## Установка
1. Клонируйте репозиторий:
    ```bash
    git clone https://github.com/dkshi/bwgtest.git
    ```

2. Перейдите в директорию проекта:
    ```bash
    cd bwgtest
    ```

3. По желанию измените `.env` файл, аналогично данному примеру:
    ```plaintext
    PORT=8080
    TIME_LOCATION=UTC
    
    DB_HOST=db # Данный параметр лучше не трогать, ведь он ссылается к названию контейнера с БД
    DB_NAME=postgres
    DB_PORT=5432
    DB_USERNAME=postgres
    DB_PASSWORD=qwerty
    DB_SSLMODE=disable
    ```

## Запуск
   Запустите приложение через Docker Compose:
   ```bash
    docker-compose up -d
   ```
